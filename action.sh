#!/system/bin/sh
# =====================================================================
# ğŸ¬ action.sh - æ¨¡å—æ“ä½œå…¥å£è„šæœ¬
# ---------------------------------------------------------------------
# ä¸€é”®å¯åŠ¨/åœæ­¢ä»£ç†æ ¸å¿ƒä¸»ç¨‹åºåŠé˜²ç«å¢™è§„åˆ™
# =====================================================================

set -e
trap '[ $? -ne 0 ] && abort_safe "â›” è„šæœ¬æ‰§è¡Œå¤±è´¥: $?"' EXIT

MODDIR=$(dirname "$0")
. "$MODDIR/common.sh"

log_safe "â¤ï¸=== [action] ===â¤ï¸"
log_safe "ğŸ¬ æ­£åœ¨åˆ‡æ¢æœåŠ¡çŠ¶æ€..."

if [ ! -x "$SERVICE" ]; then
  log_safe "âŒ æœåŠ¡è„šæœ¬ $(basename "$SERVICE") ä¸å¯æ‰§è¡Œï¼Œæ“ä½œä¸­æ­¢"
  exit 1
fi

if [ -f "$FLAG" ]; then
  log_safe "â›” æœåŠ¡å·²è¿è¡Œï¼Œæ­£åœ¨åœæ­¢..."
  if ! sh "$SERVICE" stop >/dev/null 2>&1; then
    log_safe "âŒ æœåŠ¡åœæ­¢å¤±è´¥"
    exit 1
  fi
else
  log_safe "ğŸš€ æœåŠ¡æœªè¿è¡Œï¼Œæ­£åœ¨å¯åŠ¨..."
  if ! sh "$SERVICE" >/dev/null 2>&1; then
    log_safe "âŒ æœåŠ¡å¯åŠ¨å¤±è´¥"
    exit 1
  fi
fi